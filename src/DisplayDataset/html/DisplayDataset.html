<!DOCTYPE html PUBLIC "-//W3C//DTD XHTML 1.0 Transitional//EN" "http://www.w3.org/TR/xhtml1/DTD/xhtml1-transitional.dtd">

<html>

<head>
    <title>ADMIRAL: Display dataset information</title>

    <!-- TODO: move to separate CSS file -->
    <style>
    td {
        background-color: #FFE;
    }
    </style>

    <!-- Import jQuery framework -->
    <script type="text/javascript" src="../../jQuery/js/jquery-1.4.2.js"></script> 

    <!-- Import jQuery additional libraries -->
    <script type="text/javascript" src="../../jQuery/jquery.json-2.2.js"></script> 

    <!-- Import treeview plugin -->
    <link rel="stylesheet" href="../../jQuery/jquery-treeview/jquery.treeview.css" type="text/css" />
    <script type="text/javascript" src="../../jQuery/jquery-treeview/jquery.treeview.js"></script>
    
    <!-- import rdfquery libraries -->
    <script type="text/javascript" src="../../rdfquery/jquery.uri.js"></script>
    <script type="text/javascript" src="../../rdfquery/jquery.xmlns.js"></script>
    <script type="text/javascript" src="../../rdfquery/jquery.curie.js"></script>
    <script type="text/javascript" src="../../rdfquery/jquery.datatype.js"></script>
    <script type="text/javascript" src="../../rdfquery/jquery.rdf.js"></script>
    <script type="text/javascript" src="../../rdfquery/jquery.rdfa.js"></script>
    <script type="text/javascript" src="../../rdfquery/jquery.datatype.js"></script>
    <script type="<div>
     <span><a href="/"><img alt="site_logo" src="../../images/ADMIRALogo96x96.png" border="0"/></a></span>
</div>text/javascript" src="../../rdfquery/jquery.rdf.json.js"></script>
    <script type="text/javascript" src="../../rdfquery/jquery.rdf.xml.js"></script>
    <script type="text/javascript" src="../../rdfquery/jquery.rdf.turtle.js"></script>
<!--
    <script src="../../../rdfquery/jquery.rules.js" type="text/javascript"></script>   
    <script src="../../../rdfquery/jquery.rules.rdfs.js" type="text/javascript"></script>  
-->
 
    <!-- Import MochiKit modules: require MochiKit library functions to be fully qualified -->
    <script type="text/javascript">MochiKit = {__export__: false};</script>
    <script type="text/javascript" src="../../MochiKit/Base.js"></script>
    <script type="text/javascript" src="../../MochiKit/Iter.js"></script>
    <script type="text/javascript" src="../../MochiKit/Logging.js"></script>

    <!-- Import Admiral functions -->
    <script type="text/javascript" src="../../Admiral/admiral-base.js"></script>
    <script type="text/javascript" src="../../Admiral/Error.js"></script>
    <script type="text/javascript" src="../../Admiral/AsyncComputation.js"></script>

    <!-- Import dataset information display code -->
    <script type="text/javascript" src="../DatasetTree.js"></sdatasetdetailscript>
    <link rel="stylesheet" href="../css/DisplayDataset.css" type="text/css" />
    <script type="text/javascript" src="../DisplayDatasetStatus.js"></script>
    <script type="text/javascript" src="../DisplayDatasetManifest.js"></script>
    <script type="text/javascript" src="../DatasetManifestDictionary.js"></script>
    <script>
    // Use jQuery via jQuery(...)
      jQuery.noConflict();
    </script>

    <!-- Execute the code -->
    <script>
    jQuery(document).ready( function () 
    {
        url = document.URL;
        dirUrl      =   url.split("#");
        dir         =   dirUrl[0].split("=")[1];
        reviseURL   =  "../../SubmitDatasetUI/html/SubmitDatasetDetails.html?dir="+dir
        jQuery("#revise").attr('href', reviseURL);      

        log.debug(admiral.objectString(window.location));
        var datasetName = window.location.hash;
        if( datasetName.length <= 1)
        {
             jQuery("#pageLoadStatus").text('No dataset name specified');
             jQuery("#pageLoadStatus").addClass('error');
        }
        else
        {
            datasetName = datasetName.slice(1);     // Remove '#'
            var dataSetPath = "/admiral-test/datasets/"+datasetName;
            var unpackedLink = "/admiral-test/datasets/"+datasetName;
            var packedLink = "/admiral-test/datasets/"+datasetName+"-packed";
            jQuery("#unpackedLink").attr('href', unpackedLink);  
            jQuery("#packedLink").attr('href', packedLink);  
            jQuery("#datasetPackedName").text(datasetName+"-packed");  
            jQuery("#datasetUnpackedName").text(datasetName);          

            var m = new admiral.AsyncComputation();
            
            m.eval(function (val, callback)
            {
               admiral.datasetManifestDictionary(dataSetPath,datasetName, callback);
            });
            
            m.eval(function (datasetdetails, callback)
            {   
                jQuery("#pageLoadStatus").text("");
                jQuery("#datasetName").text(datasetdetails.datasetName);
                jQuery("#createdBy").text(datasetdetails.createdBy);
                jQuery("#derivedFrom > a").text(datasetdetails.derivedFrom);
                jQuery("#derivedFrom > a").attr("href", datasetdetails.derivedFrom);
                jQuery("#currentVersion").text(datasetdetails.currentVersion);
                jQuery("#embargoExpiryDate").text(datasetdetails.embargoExpiryDate);
                jQuery("#title").text(datasetdetails.title);
                jQuery("#lastModified").text(datasetdetails.lastModified);
                jQuery("#description").text(datasetdetails.description);
                jQuery(".manifest").text("");
                
                callback(datasetdetails);        
            });
            m.eval(function(datasetdetails, callback)
            {
                var seglists = admiral.segmentPaths(datasetdetails.fileRelativePaths.sort());
                var segtree  = admiral.segmentTreeBuilder(seglists);
                var seghtml  = admiral.nestedListBuilder(datasetdetails.baseUri, segtree);
                jQuery(".manifest").append(seghtml);
                seghtml.treeview({ collapsed: true }); 
            
            });
            m.exec(null, admiral.noop);
        }
        
    });
  </script>  

</head>

<body>
    <div>
        <span><a href="/"><img alt="site_logo" src="../../images/ADMIRALogo96x96.png" border="0"/></a></span>
    </div>
   <h1>Dataset Identifier : <a id="datasetLink" href="dummy"><span id="datasetName">...</span></a></h1>
   <div class="dataset">
     <div id="pageLoadStatus"></div>
     <table name="submissionStatus" id = "submissionStatus" >
        <!--<tr><td>Submission identifier</td><td id="submissionIdentifier">...</td></tr> -->
        <tr><td>Title</td><td id="title">...</td></tr>
        <tr><td>Description</td><td id="description">...</td></tr>
        <tr><td>Submitted by</td><td id="createdBy">...</td></tr>
        <tr><td>Submitted on</td><td><span id="lastModified">yyyy-mm-dd</span> (version <span id="currentVersion">nn</span>)</td></tr>
        <tr><td>Status</td>
            <td><span id="embargoed">Embargoed until <span id="embargoExpiryDate">(embargoed)</span></span>
                <span id="published">Published</span>
            </td>
        </tr>
        <tr><td>Databank URL to download this dataset</td><td><span id="derivedFrom"><a href="link">...</a></span></td></tr>
     </table>
   </div>
   <h2>Contents of dataset</h2>
   <div class="manifest">(to be replaced)</div>


   <h5>View Data in Databank: <span id="datasetUnpackedName"></span> - <a href="" id="unpackedLink">data</a></h5>
   <h5>View Data in Databank: <span id="datasetPackedName"></span> - <a href="" id="packedLink">packaged data</a></h5>
   <h5><a href="" id="revise">Submit revised version</a></h5>
</body>

</html>
